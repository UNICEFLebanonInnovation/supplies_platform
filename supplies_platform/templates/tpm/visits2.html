{% load staticfiles i18n %}
{% load static %}
{% load render_table from django_tables2 %}
<!--{% load bootstrap3 %}-->
<!--{% bootstrap_css %}-->
{% load util_tags %}
<!DOCTYPE html>
<!-- saved from url=(0022) -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    <!-- End SEO tag -->
    <!-- FAVICONS -->
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <title>{% block title %}SMS{% endblock title %}</title>
    <link rel="apple-touch-icon" sizes="57x57" href="{% static 'images/apple-icon-57x57.png' %}">
    <link rel="apple-touch-icon" sizes="60x60" href="{% static 'images/apple-icon-60x60.png' %}">
    <link rel="apple-touch-icon" sizes="72x72" href="{% static 'images/apple-icon-72x72.png' %}">
    <link rel="apple-touch-icon" sizes="76x76" href="{% static 'images/apple-icon-76x76.png' %}">
    <link rel="apple-touch-icon" sizes="114x114" href="{% static 'images/apple-icon-114x114.png' %}">
    <link rel="apple-touch-icon" sizes="120x120" href="{% static 'images/apple-icon-120x120.png' %}">
    <link rel="apple-touch-icon" sizes="144x144" href="{% static 'images/apple-icon-144x144.png' %}">
    <link rel="apple-touch-icon" sizes="152x152" href="{% static 'images/apple-icon-152x152.png' %}">
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'images/apple-icon-180x180.png' %}">
    <link rel="icon" type="image/png" sizes="192x192" href="{% static 'images/android-icon-192x192.png' %}">
    <link rel="icon" type="image/png" sizes="32x32" href="{% static 'images/favicon-32x32.png' %}">
    <link rel="icon" type="image/png" sizes="96x96" href="{% static 'images/favicon-96x96.png' %}">
    <link rel="icon" type="image/png" sizes="16x16" href="{% static 'images/favicon-16x16.png' %}">
    <link rel="manifest" href="{% static 'images/manifest.json' %}">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">

    <script src="{% static 'dashboard/pace.min.js' %}"></script>
    <!-- BEGIN BASE STYLES -->
    <link rel="stylesheet" href="{% static 'dashboard/pace.min.css' %}">
    <link rel="stylesheet" href="{% static 'dashboard/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'dashboard/open-iconic-bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'dashboard/fontawesome-all.min.css' %}">
    <!-- END BASE STYLES -->
    <!-- BEGIN PLUGINS STYLES -->
    <link rel="stylesheet" href="{% static 'dashboard/flatpickr.min.css' %}">
    <!-- END PLUGINS STYLES -->
    <!-- BEGIN THEME STYLES -->
    <link rel="stylesheet" href="{% static 'dashboard/main.min.css' %}">
    <link rel="stylesheet" href="{% static 'dashboard/custom.css' %}">
    <link href="{% static 'css/tracking.css' %}" rel="stylesheet">
    <!-- END THEME STYLES -->
  <style type="text/css">/* Chart.js */
@-webkit-keyframes chartjs-render-animation{from{opacity:0.99}to{opacity:1}}@keyframes chartjs-render-animation{from{opacity:0.99}to{opacity:1}}.chartjs-render-monitor{-webkit-animation:chartjs-render-animation 0.001s;animation:chartjs-render-animation 0.001s;}</style></head>
  <body class="  pace-done"><div class="pace  pace-inactive"><div class="pace-progress" data-progress-text="100%" data-progress="99" style="transform: translate3d(100%, 0px, 0px);">
  <div class="pace-progress-inner"></div>
</div>
<div class="pace-activity"></div></div>
    <!-- .app -->
    <div class="app">
      <!-- .app-header -->
      <header class="app-header">
        <!-- .top-bar -->
        <div class="top-bar">
          <!-- .top-bar-brand -->
          <div class="top-bar-brand">
            <a href="">
              <img src="{% static 'images/logo_transparant.png' %}" height="50" width="150" alt="">
            </a>
          </div>
          <!-- /.top-bar-brand -->
          <!-- .top-bar-list -->
          <div class="top-bar-list">
            <!-- .top-bar-item -->
            <div class="top-bar-item px-2 d-md-none d-lg-none d-xl-none">
              <!-- toggle menu -->
              <button class="hamburger hamburger-squeeze" type="button" data-toggle="aside" aria-label="Menu" aria-controls="navigation">
                <span class="hamburger-box">
                  <span class="hamburger-inner"></span>
                </span>
              </button>
              <!-- /toggle menu -->
            </div>
            <!-- /.top-bar-item -->
            <!-- .top-bar-item -->
            <div class="top-bar-item top-bar-item-full">
              <!-- .top-bar-search -->
              <div class="top-bar-search">
                <div class="input-group input-group-search">
                  <div class="input-group-prepend">
                    <span class="input-group-text">
                      <span class="oi oi-magnifying-glass"></span>
                    </span>
                  </div>
                  <input type="text" class="form-control" aria-label="Search" placeholder="Search"> </div>
              </div>
              <!-- /.top-bar-search -->
            </div>
            <!-- /.top-bar-item -->
            <!-- .top-bar-item -->
            <div class="top-bar-item top-bar-item-right px-0 d-none d-sm-flex">
              <!-- .nav -->
              <ul class="header-nav nav">
                <!-- .nav-item -->
                <li class="nav-item dropdown header-nav-dropdown has-notified">
                  <a class="nav-link" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <span class="oi oi-envelope-open"></span>
                  </a>
                  <div class="dropdown-arrow"></div>
                  <!-- .dropdown-menu -->
                  <div class="dropdown-menu dropdown-menu-rich dropdown-menu-right">
                    <h6 class="dropdown-header stop-propagation">
                      <span>Messages</span>
                      <a href="">Mark all as read</a>
                    </h6>
                    <!-- .dropdown-scroll -->
                    <div class="dropdown-scroll has-scrollable ps">
                      {% for item in notifications %}
                      <!-- .dropdown-item -->
                      <a href="" class="dropdown-item unread">
                        <div class="user-avatar">
                          {% if item.status %}
                          <img src="{% static 'dashboard/email-read-icon.png' %}" alt="">
                          {% else %}
                          <img src="{% static 'dashboard/email-unread-icon.png' %}" alt="">
                          {% endif %}
                        </div>
                        <div class="dropdown-item-body">
                          <p class="subject"> {{ item.subject }} </p>
                          <p class="text text-truncate"> {{ item.description }} </p>
                          <span class="date">{{ item.created }}</span>
                        </div>
                      </a>
                      {% endfor %}
                      <!-- /.dropdown-item -->
                    <div class="ps__rail-x" style="left: 0px; bottom: 0px;"><div class="ps__thumb-x" tabindex="0" style="left: 0px; width: 0px;"></div></div><div class="ps__rail-y" style="top: 0px; right: 0px;"><div class="ps__thumb-y" tabindex="0" style="top: 0px; height: 0px;"></div></div></div>
                    <!-- /.dropdown-scroll -->
                    <a href="" class="dropdown-footer">All messages
                      <i class="fa fa-fw fa-long-arrow-alt-right"></i>
                    </a>
                  <!-- /.dropdown-menu -->
                </li>
                <!-- /.nav-item -->
                <!-- .nav-item -->
                <li class="nav-item dropdown header-nav-dropdown">
                  <a class="nav-link" href="" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    <span class="oi oi-grid-three-up"></span>
                  </a>
                  <div class="dropdown-arrow"></div>
                  <!-- .dropdown-menu -->
                  <div class="dropdown-menu dropdown-menu-rich dropdown-menu-right">
                    <!-- .dropdown-sheets -->
                    <div class="dropdown-sheets">
                      <!-- .dropdown-sheet-item -->
                      <div class="dropdown-sheet-item">
                        <a href="{% url 'tpm:visits' %}" class="tile-wrapper">
                          <span class="tile tile-lg bg-cyan">
                            <i class="oi oi-document"></i>
                          </span>
                          <span class="tile-peek">SM Visits</span>
                        </a>
                      </div>
                      <!-- /.dropdown-sheet-item -->
                    </div>
                    <!-- .dropdown-sheets -->
                  </div>
                  <!-- .dropdown-menu -->
                </li>
                <!-- /.nav-item -->
              </ul>
              <!-- /.nav -->
              <!-- .btn-account -->
              <div class="dropdown">
                <button class="btn-account d-none d-md-flex" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                  <span class="user-avatar">
                    <img src="{% static 'dashboard/profile.png' %}" alt="">
                  </span>
                  <span class="account-summary pr-lg-4 d-none d-lg-block">
                    <span class="account-name">{{ request.user }}</span>
                    <span class="account-description"></span>
                  </span>
                </button>
                <div class="dropdown-arrow dropdown-arrow-left"></div>
                <!-- .dropdown-menu -->
                <div class="dropdown-menu">
                  <h6 class="dropdown-header d-none d-md-block d-lg-none"> Beni Arisandi </h6>
                  <a class="dropdown-item" href="">
                    <span class="dropdown-icon oi oi-person"></span> Profile</a>
                  <a class="dropdown-item" href="{% url 'account_logout' %}">
                    <span class="dropdown-icon oi oi-account-logout"></span> Logout</a>
                  <div class="dropdown-divider"></div>
                  <a class="dropdown-item" href="">Help Center</a>
                </div>
                <!-- /.dropdown-menu -->
              </div>
              <!-- /.btn-account -->
            </div>
            <!-- /.top-bar-item -->
          </div>
          <!-- /.top-bar-list -->
        </div>
        <!-- /.top-bar -->
      </header>
      <!-- /.app-header -->
      <!-- .app-aside -->
      <aside class="app-aside">
        <!-- .aside-content -->
        <div class="aside-content">
          <!-- .aside-header -->
          <header class="aside-header d-block d-md-none">
            <!-- .btn-account -->
            <button class="btn-account" type="button" data-toggle="collapse" data-target="#dropdown-aside">
              <span class="user-avatar user-avatar-lg">
                <img src="{% static 'dashboard/profile.png' %}" alt="">
              </span>
              <span class="account-icon">
                <span class="fa fa-caret-down fa-lg"></span>
              </span>
              <span class="account-summary">
                <span class="account-name">{{ request.user }}</span>
                <span class="account-description"></span>
              </span>
            </button>
            <!-- /.btn-account -->
            <!-- .dropdown-aside -->
            <div id="dropdown-aside" class="dropdown-aside collapse">
              <!-- dropdown-items -->
              <div class="pb-3">
                <a class="dropdown-item" href="">
                  <span class="dropdown-icon oi oi-person"></span> Profile</a>
                <a class="dropdown-item" href="">
                  <span class="dropdown-icon oi oi-account-logout"></span> Logout</a>
                <div class="dropdown-divider"></div>
                <a class="dropdown-item" href="">Help Center</a>
              </div>
              <!-- /dropdown-items -->
            </div>
            <!-- /.dropdown-aside -->
          </header>
          <!-- /.aside-header -->
          <!-- .aside-menu -->
          <section class="aside-menu has-scrollable ps ps--active-y">
            <!-- .stacked-menu -->
            <nav id="stacked-menu" class="stacked-menu stacked-menu-has-collapsible">
              <!-- .menu -->
              <!-- /.menu -->
            </nav>
            <!-- /.stacked-menu -->
          <div class="ps__rail-x" style="left: 0px; bottom: 0px;"><div class="ps__thumb-x" tabindex="0" style="left: 0px; width: 0px;"></div></div><div class="ps__rail-y" style="top: 0px; height: 760px; right: 0px;"><div class="ps__thumb-y" tabindex="0" style="top: 0px; height: 644px;"></div></div></section>
          <!-- /.aside-menu -->
        </div>
        <!-- /.aside-content -->
      </aside>
      <!-- /.app-aside -->
      <!-- .app-main -->
      <main class="app-main">
        <!-- .wrapper -->
        <div class="wrapper">
          <!-- .page -->
          <div class="page"><div class="sidebar-backdrop"></div>
            <!-- .page-inner -->
            <div class="page-inner">
              <!-- .page-title-bar -->
              <header class="page-title-bar">
                <p class="lead">
                  <span class="font-weight-bold"></span>
                  <span class="d-block text-muted"></span>
                </p>
              </header>
              <!-- /.page-title-bar -->
              <!-- .page-section -->
              <div class="">
                <!-- .section-block -->
                <div class="section-block">
                  <!-- metric row -->
                  <div class="metric-row">

                  </div>
                  <!-- /metric row -->
                </div>
                <div class="section-deck">
                  <!-- .card -->
                  <div class="card card-fluid">
                    <header class="card-header"> Supply Monitoring Visits <span class="badge">({{ table.rows|length }})</span></header>
                    <!-- .lits-group -->
                    {% csrf_token %}
                    {% render_table table 'django_tables2/bootstrap.html' %}
                    <!-- /.lits-group -->
                  </div>
                  <!-- /.card -->
                </div>
                <!-- /section-deck -->
              </div>
              <!-- /.page-section -->
            </div>
            <!-- /.page-inner -->
          </div>
          <!-- /.page -->
        </div>
        <!-- /.wrapper -->
      </main>
      <!-- /.app-main -->
    <div class="app-backdrop"></div></div>
    <!-- /.app -->
    <!-- BEGIN BASE JS -->
    <script src="{% static 'dashboard/jquery.min.js' %}"></script>
    <script src="{% static 'dashboard/popper.min.js' %}"></script>
    <script src="{% static 'dashboard/bootstrap.min.js' %}"></script>
    <!-- END BASE JS -->
    <!-- BEGIN PLUGINS JS -->
    <script src="{% static 'dashboard/stacked-menu.min.js' %}"></script>
    <script src="{% static 'dashboard/perfect-scrollbar.min.js' %}"></script>
    <script src="{% static 'dashboard/flatpickr.min.js' %}"></script>
    <script src="{% static 'dashboard/jquery.easypiechart.min.js' %}"></script>
    <script src="{% static 'dashboard/Chart.min.js' %}"></script>
    <!-- END PLUGINS JS -->
    <!-- BEGIN THEME JS -->
    <script src="{% static 'dashboard/main.min.js' %}"></script>
    <!-- END THEME JS -->
    <!-- BEGIN PAGE LEVEL JS -->
    <script src="{% static 'dashboard/easypiechart-demo.js' %}"></script>
    <!--<script src="{% static 'dashboard/dashboard-demo.js' %}"></script>-->
    <!-- END PAGE LEVEL JS -->
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <!--<script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-116692175-1"></script>-->
    <script>
      window.dataLayer = window.dataLayer || [];

      function gtag()
      {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', 'UA-116692175-1');
    </script>
    {% get_user_token request.user.id as user_token %}
    <!--<script type="text/javascript" language="javascript" src="{% static 'js/jquery-1.12.3.min.js' %}"></script>-->
    <!--<script type="text/javascript" language="javascript" src="{% static 'js/jquery-ui-1.12.1.js' %}"></script>-->
    <script>
        var tpm_url = '/api/tpm-visits/';
        var user_token = '{{ user_token }}';
        var user_id = '{{ request.user.id }}';
        var user_email = '{{ request.user }}';
        var csrftoken = $('input[name=csrfmiddlewaretoken]').val();


        $(document).ready(function() {

            $('.assign-me').dblclick(function(){
                if($(this).hasClass('unassigned')) {
                  assign_to_me($(this), user_id);
                }else{
                  assign_to_me($(this), null);
                }
            });

            $('.assign-tpm').dblclick(function(){
                var itemref = $(this).attr('itemref');
                $('.assign-tpm-block').addClass('d-none');
                $('#assign-tpm-block-'+itemref).removeClass('d-none');
            });

            $('.save-assign-btn').click(function(){
                var item = $(this);
                var itemref = item.attr('itemref');
                if($('#asisgned-tpm-'+itemref).val()) {
                    assign_to_tpm(item, $('#asisgned-tpm-'+itemref).val(), $('#asisgned-tpm-'+itemref).find(':selected').text());
                }
            });

            $('.cancel-assign-btn').click(function(){
                var itemref = $(this).attr('itemref');
                $('#assign-tpm-block-'+itemref).addClass('d-none');
                $('#assign-btn-'+itemref).removeClass('d-none');
            });

        });

        function getHeader()
        {
            var header = {
                'Authorization': 'Token '+user_token,
                'HTTP_REFERER': $(location).attr('href'),
                'Cookie': 'token=Token '+user_token,
                'X-CSRFToken': csrftoken
            };
            return header;
        }

        function assign_to_me(item, user)
        {
            var data = {assigned_to_officer:user}
            $.ajax({
                type: "PATCH",
                url: tpm_url+item.attr('itemref')+'/',
                data: data,
                cache: false,
                headers: getHeader(),
                dataType: 'json',
                success: function (response, result, jqXHR) {
                    if(jqXHR.status == 200){
                        if(user) {
                          item.find('.assigned_to_me').text(user_email);
                          item.removeClass('unassigned');
                          item.addClass('assigned');
                          item.removeClass('btn-info');
                          item.addClass('btn-success');
                        }else{
                          item.find('.assigned_to_me').text('Assign to me?');
                          item.removeClass('assigned');
                          item.addClass('unassigned');
                          item.addClass('btn-info');
                          item.removeClass('btn-success');
                        }
                    }
                },
                error: function (response) {
                    console.log(response);
                }
            });
        }

        function assign_to_tpm(item, user, user_fullname)
        {
            var data = {assigned_to_tpm:user}
            var itemref = item.attr('itemref')
            $.ajax({
                type: "PATCH",
                url: tpm_url+itemref+'/',
                data: data,
                cache: false,
                headers: getHeader(),
                dataType: 'json',
                success: function (response, result, jqXHR) {
                    if(jqXHR.status == 200){
                        $('#assign-btn-'+itemref).find('.assigned_to_tpm_name').text(user_fullname);
                        $('#assign-tpm-block-'+itemref).addClass('d-none');
                    }
                },
                error: function (response) {
                    console.log(response);
                }
            });
        }

    </script>


</body></html>
