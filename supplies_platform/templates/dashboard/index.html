{% extends "base2.html" %}
{% load static %}
{% load util_tags %}

{% block css %}
  <style type="text/css">
    a.toggle-status:hover .dropdown-item-body { color: white !important;}
    a.filter-link {color: white !important; }
  </style>
{% endblock %}

{% block page-inner %}
    <!-- .page-title-bar -->
    <header class="page-title-bar">
      <p class="lead">
        <span class="font-weight-bold"></span>
        <span class="d-block text-muted"></span>
      </p>
    </header>
    <!-- /.page-title-bar -->
    <!-- .page-section -->
    <!--<div class="page-section">-->
    <div style="">
      <!-- .section-block -->
      <div class="section-block">

        <div class="metric-bordered" style="height: 65px; padding: 10px; position: relative;">
              <!--<i class="fa fa-filter" style="position: absolute; top: -2px;left: -7px;"></i>-->
              <div class="" style="float: left; width: 100px; padding:5px;">
                {% if not selected_section %}<h5>{% endif %}
                <a class="filter-link" href="{% url 'dashboard:index' %}">
                  <span class="badge badge-lg badge-secondary" style="width: 80px; border: 1px solid #d4d5d7; background: #d4d5d7;">
                    <span class="oi oi-media-record pulse mr-1"></span> ALL </span>
                </a>
                {% if not selected_section %}</h5>{% endif %}
              </div>
          {% for item in sections %}
              <div class="" style="float: left; width: 100px; padding:5px; color: white;">
                {% if selected_section == item.id %}<h5>{% endif %}
                <a class="filter-link" href="{% url 'dashboard:index' %}?section={{ item.id }}">
                <span class="badge badge-lg {{ item.color }}">
                  <span class="oi oi-media-record pulse mr-1"></span> {{ item.code }} </span>
                </a>
                {% if selected_section == item.id %}</h5>{% endif %}
              </div>
          {% endfor %}
        </div>
        <!-- metric row -->
        <div class="metric-row">
          <!-- metric column -->

          <div class="col-lg-3">
            <!-- .metric -->
            <span class="metric metric-bordered">
              <div class="metric-badge">
                <span class="badge badge-lg badge-primary">
                  <span class="oi oi-media-record pulse mr-1"></span> PLANNED SUPPLY PLAN </span>
              </div>
              <p class="metric-value h3">
                <sub>
                  <i class="oi oi-timer"></i>
                </sub>
                <span class="value">{{ nbr_planned }}</span>
              </p>
            </span>
            <!-- /.metric -->
          </div>

          <div class="col-lg-3">
            <!-- .metric -->
            <span class="metric metric-bordered">
              <div class="metric-badge">
                <span class="badge badge-lg badge-success">
                  <span class="oi oi-media-record pulse mr-1"></span> PLANNED DISTRIBUTION PLAN </span>
              </div>
              <p class="metric-value h3">
                <sub>
                  <i class="oi oi-timer"></i>
                </sub>
                <span class="value">{{ nbr_dist_planned }}</span>
              </p>
            </span>
            <!-- /.metric -->
          </div>

          <div class="col-lg-3">
            <!-- .metric -->
            <span class="metric metric-bordered">
              <div class="metric-badge">
                <span class="badge badge-lg badge-success">
                  <span class="oi oi-media-record pulse mr-1"></span> APPROVED DISTRIBUTION PLAN </span>
              </div>
              <p class="metric-value h3">
                <sub>
                  <i class="oi oi-timer"></i>
                </sub>
                <span class="value">{{ nbr_dist_approved }}</span>
              </p>
            </span>
            <!-- /.metric -->
          </div>

          <div class="col-lg-3">
            <!-- .metric -->
            <span class="metric metric-bordered">
              <div class="metric-badge">
                <span class="badge badge-lg badge-warning">
                  <span class="oi oi-media-record pulse mr-1"></span> WAVES DELAYED FOR DELIVERY </span>
              </div>
              <p class="metric-value h3">
                <sub>
                  <i class="oi oi-timer"></i>
                </sub>
                <span class="value">{{ nbr_delayed_delivery }}</span>
              </p>
            </span>
            <!-- /.metric -->
          </div>

          <div class="col-lg-3">
            <!-- .metric -->
            <span class="metric metric-bordered">
              <div class="metric-badge">
                <span class="badge badge-lg badge-warning">
                  <span class="oi oi-media-record pulse mr-1"></span> READY TO DISTRIBUTE </span>
              </div>
              <p class="metric-value h3">
                <sub>
                  <i class="oi oi-warning"></i>
                </sub>
                <span class="value">{{ nbr_dist_ready }}</span>
              </p>
            </span>
            <!-- /.metric -->
          </div>

          <div class="col-lg-3">
            <!-- .metric -->
            <span class="metric metric-bordered">
              <div class="metric-badge">
                <span class="badge badge-lg badge-danger">
                  <span class="oi oi-media-record pulse mr-1"></span> WAVES NOT RECEIVED </span>
              </div>
              <p class="metric-value h3">
                <sub>
                  <i class="oi oi-warning"></i>
                </sub>
                <span class="value">{{ nbr_not_received }}</span>
              </p>
            </span>
            <!-- /.metric -->
          </div>
          <!-- /metric column -->
        </div>
        <!-- /metric row -->
      </div>
      <div class="section-deck">
        <!-- .card -->
        <div class="card card-fluid">
          <header class="card-header"> Active Distribution request plans </header>
          <!-- .lits-group -->
          <div style="height:500px; overflow: scroll;">
          {% for item in request_waves %}
          <div class="lits-group list-group-flush">
            <!-- .lits-group-item -->
            <div class="list-group-item">
              <!-- .lits-group-item-figure -->
              <div class="list-group-item-figure">
                <div class="has-badge">
                  <a href="" class="tile tile-md {{ item.plan.plan.section.color }}">{{ item.plan.plan.section.code }}</a>
                  <a href="team" class="">
                    <!--<img src="{% static 'dashboard/team1.jpg' %}" alt="">-->
                  </a>
                </div>
              </div>
              <!-- .lits-group-item-figure -->
              <!-- .lits-group-item-body -->
              <div class="list-group-item-body">
                <h5 class="card-title mb-2">
                  <a href="/admin/planning/distributionplan/{{ item.plan_id }}/change/#request" target="_blank">WAVE #{{ item.wave_number }} {{ item.plan }}</a>
                </h5>
                <!--<p class="card-subtitle text-muted"> Progress in 74% - Last update date </p>-->
                {% with item.plan as distribution %}
                <!--<p class="card-subtitle text-muted" style="padding-left: 35px;">{{ distribution.modified }}</p>-->

                    <div class="row shop-tracking-status">

                        <div class="col-md-12">
                            <div class="well">

                                <div class="order-status">

                                    <div class="order-status-timeline">
                                        <!-- class names: c0 c1 c2 c3 and c4 -->
                                        {% if distribution.item_distributed %}
                                          <div class="order-status-timeline-completion c4 {{ distribution.plan.section.color }}"></div>
                                        {% elif item.received_wave.all.first %}
                                          <div class="order-status-timeline-completion c3 {{ distribution.plan.section.color }}"></div>
                                        {% elif item.delivery_expected_date %}
                                          <div class="order-status-timeline-completion c2 {{ distribution.plan.section.color }}"></div>
                                        {% elif distribution.status == 'submitted' %}
                                          <div class="order-status-timeline-completion c1 {{ distribution.plan.section.color }}"></div>
                                        {% else %}
                                          <div class="order-status-timeline-completion c0 {{ distribution.plan.section.color }}"></div>
                                        {% endif %}
                                    </div>

                                    <div class="image-order-status supply-plan-icon active img-circle">
                                        <span class="status text-muted">{{ distribution.plan.status }}</span>
                                        <div class="icon"></div>
                                    </div>
                                    <div class="image-order-status distribution-plan-icon active img-circle">
                                        <span class="status text-muted">{{ distribution.status }}</span>
                                        <div class="icon"></div>
                                    </div>
                                    <div class="image-order-status shipping-icon active img-circle">
                                        <span class="status text-muted">{% if item.delivery_expected_date %}
                                                  {{ item.delivery_expected_date }}
                                                {% endif %}
                                        </span>
                                        <div class="icon"></div>
                                    </div>
                                    <div class="image-order-status received-icon active img-circle">
                                      {% if item.received_wave.all %}
                                          {% with item.received_wave.all.first as received_wave %}
                                            <span class="text-muted" style="position: absolute; top: -25px; left: 35px; font-style: italic; width: 172px;">
                                                {{ received_wave.supply_item.code }}: {{ received_wave.quantity_received }} of {{ received_wave.quantity_requested }}
                                            </span>
                                            <span class="status text-muted">
                                                {{ received_wave.date_received }}
                                            </span>
                                          {% endwith %}
                                      {% endif %}
                                        <div class="icon"></div>
                                    </div>
                                    <div class="image-order-status distributed-icon active img-circle">
                                        <span class="status text-muted">
                                          {% if item.distributed_wave.all %}
                                            {{ item.distributed_wave.all.first.distributed_sites.all.count }} Site(s)
                                          {% endif %}
                                        </span>
                                        <div class="icon"></div>
                                    </div>

                                </div>
                            </div>
                        </div>

                    </div>
                    {% endwith %}
                <!-- /.progress -->
              </div>
              <!-- .lits-group-item-body -->
            </div>
            <!-- /.lits-group-item -->
          </div>
          {% endfor %}
          </div>
          <!-- /.lits-group -->
        </div>
        <!-- /.card -->
      </div>
      <!-- /section-deck -->
    </div>
    <!-- /.page-section -->

{% endblock %}

{% block custom_javascript %}

{% endblock custom_javascript %}
